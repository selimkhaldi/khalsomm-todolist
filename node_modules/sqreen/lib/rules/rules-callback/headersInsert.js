/**
 * Copyright (c) 2016 Sqreen. All Rights Reserved.
 * Please refer to our terms for more information: https://www.sqreen.io/terms.html
 */
'use strict';
const Http = require('http');

/**
 * Return the callback for header insertion
 * @author vdeturckheim
 * @framework none
 * @target events['']['']['prototype:emit']
 * @returns {{post: post}}
 */
module.exports.getCbs = function () {

    return {
        post: function (args, value, rule) {

            if (!rule || !rule.data || !rule.data.values) {
                return;
            }
            if (args[0] === 'request' &&
                ((Http.ServerResponse.__original && args[2] instanceof Http.ServerResponse.__original) || args[2] instanceof Http.ServerResponse) &&
                !args[2]._header) {
                const values = rule.data.values;
                for (let i = 0; i < values.length; ++i) {
                    args[2].setHeader(values[i][0], values[i][1]);
                }
            }
        }
    };
};
